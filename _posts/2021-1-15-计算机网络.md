---
date: 2020-11-02 16:10:40
layout: post
title: 计算机网络
author: 
---



## 一.应用层

#### 1.1两个经典的体系结构

- 客户——服务器体系结构：有一个总是打开的主机称为服务器，它服务于来自许多其它称为客户的主机的请求，在这个体系之中，客户之间不直接通信，另一个特征是该服务器具有固定的、周知的地址。需要配备大量主机的数据中心。

  判断客户和服务器的原则：在会话开始时发起与其他进程的联系的进程被标识为客户，在会话开始时等待被联系的进程是服务器。

- P2P体系结构：应用程序在间断连接的主机对之间使用直接通信，这些主机对被称为对等方。在一个P2P文件共享应用中，尽管每个对等方都由于请求文件而产生负载，但是每个对等方通过向其他对等方分发文件也为系统增加服务能力。目前P2P应用由于高度非集中式结构，面临安全性、性能和可靠性等挑战。

  判断客户和服务器的原则：在P2P文件共享之中，当对等方A请求对等方B发送一个特定的文件时，在这个特定的通信会话中对等     方A是客户，B是服务器。

​       

#### 1.2 进程与计算机网络之间的接口

当一个进程向另外一个主机的进程发送报文时，应用程序将报文推进套接字进入运输层之中，运输层协议负责将该套接字的报文取出 ，当报文到达目的主机，它通过接受进程的门（套接字）传递，然后接受接受报文进行处理。

套接字是同一台主机内应用层与运输层之间的接口。由于套接字是建立网络应用程序的可编程接口，因此套接字又被称为应用程序与网络之间的应用程序编程接口（API）

#### 1.3应用程序服务要求（对运输层协议）

- 可靠的数据传输(丢包)：当一个运输层协议提供这种服务时，发送进程只要将数据传送进套接字，就可以完全相信该数据能够无差错的到达接收进程。
- 吞吐量(速率)：发送进程能够向接收进程交付比特的速率，当一个运输层协议提供这种服务时，，应用程序能够请求r比特/秒的确保吞吐量，并且该运输协议能够确保可用吞吐量总是至少为r比特/秒（一般情况下，吞吐量会随时间波动）
- 定时(时延)： 提供这种服务，可使发送方注入进套接字中的每个比特到达接收方的套接字不迟于一个固定的数值，这种服务对交互式实时应用程序具有吸引力。
- 安全性(安全)： 加密由发送进程传输的所有数据，以防该数据以某种方式在这两个进程之间被观察到。



#### 1.4 因特网提供的运输服务

 因特网为应用程序提供两个运输层协议：TCP和UDP

- TCP服务：提供面向连接的服务和可靠的数据传送服务，TCP还具有拥塞控制机制（当发送方和接收方之间的网络出现拥塞时，TCP的拥塞控制机制会抑制发送进程)。TCP和UDP都没有提供任何加密机制，但是现在有TCP的加强版本称为安全套接字（SSL），如果一个应用程序想用SSL服务，他需要在该应用程序的客服端和服务器端包括SSL代码。
- UDP服务：UDP通信前没有握手过程，UDP提供的是一种不可靠数据传送服务，并不保证报文将到达接收进程，而且到达接受进程的报文也可能是乱序到达的。UDP没有拥塞控制机制，所以UDP的发送端可以用它选定的任何速率向其下层（网络层）注入数据。
- 今天的因特网通常能为时间敏感应用提供满意的服务，但它不能提供任何定时或带宽的保证。

#### 1.5 HTTP和Web

web的应用层协议是HTTP（HyperText Transfer Protocol）,它是web的核心。HTTP定义了报文的结构以及客户和服务器进行报文交换的方式。Web服务器实现了HTTP的服务器端，用于存储Web对象，每个对象由URL寻址。

- HTTP使用TCP作为它的支撑运输协议。HTTP客户首先发起一个与服务器的TCP连接，连接建立后，客户向它的套接字接口发送HTTP请求报文并从它的套接字接口接收HTTP响应报文，服务器从它的套接字接口接收HTTP报文，并向它的套接字接口发送报文。
- HTTP协议不用担心数据丢失，也不关心TCP实现可靠数据传输的细节，这就是分层体系结构最大的优点。
- HTTP服务器并不保存关于客户的任何信息，所以HTTP是一个无状态协议

#### 1.6 非持续连接/持续连接的HTTP

服务器向客户传送一个web页面（1个HTML文件和10个JPEG图形）的步骤

- 非持续连接的HTTP：
  - HTTP客户进程在端口号80发起一个到服务器的TCP连接，在客户和服务器上分别有一个套接字与该连接相关联。
  - HTTP客户经它的套接字向服务器发送一个HTTP请求报文。
  - HTTP服务器进程经它的套接字接收该请求报文，从其存储器中检索出对象，在一个响应报文中封装对象，并通过套接字向客户发送响应报文。
  - HTTP服务器进程通知TCP断开该TCP连接（但是直到TCP确定客户已接收到响应报文时，它才会断开）
  - HTTP客户接收响应报文，TCP连接关闭，该报文指出封装对象是一个HTML文件，客户从响应报文中提取出该文件，检查HTML文件，得到对10个JPEG图形的引用。
  - 对每个JPEG的引用重复前四个步骤
- 持续连接的HTTP服务器在发送响应后保持该TCP连接打开，在相同的客户和服务器之间，后续的请求和响应报文能够通过相同的连接进行传送。一个完整的web页面可以用单个持续的连接进行传送，甚至位于同一台服务器的多个web页面在从该服务器发送给同一个客户时，也可在单个持续TCP连接上进行。

估算从客户请求HTML文件到该用户收到整个文件的时间：RTT（分组传播时延、分组在中间路由器和交换机上的排队时延、分组处理时延）    当用户点击一个超链接时：浏览器在它和服务器之间发起一个TCP连接（包含三次握手）的过程，即客户向服务器发送一个小TCP报文段，服务器用一个小TCP报文段做出确认和响应，最后客户向服务器返回确认。三次握手的前两次占用一个RTT，客户结合三次握手的第三部分（确认）向该TCP连接发送一个HTTP请求报文，一旦到达服务器，服务器就在该TCP连接上发送HTML文件。HTTP请求和响应用去另一个RTT，因此，总的响应时间粗略为两个RTT加上服务器传输HTML文件的时间。

#### 1.7 HTTP报文格式

##### 1.7.1 HTTP请求报文

HTTP的第一行叫做请求行，其后继的行叫做首部行。请求行有三个字段：方法字段、URL字段和HTTP版本字段。方法字段的五种不同值：GET、POST、HEAD、PUT、和DELETE。

通常HTTP请求报文使用GET方法；用户提交表单时，HTTP客户通常用POST方法；当服务器收到一个使用HEAD的请求时，将会用一个HTTP报文进行响应，但是并不返回对象；PUT方法常用web发行工具联合使用，它允许用户上传对象到指定的web服务器的指定的路径；DELETE方法允许用户或者应用程序删除web服务器上的对象。

##### 1.7.2 HTTP响应报文

```http
HTTP/1.1 200 OK //初始状态行  6个首部行

Connection: close //发送完成后将关闭TCP连接

Date: TUE, 18 Aug 2015 15:44:04 GMT //服务器从它的文件系统中检索到该对象，将该对象插入响应报文，并发送响应报文的时间

Server: Apache/2.2.3(CentOS) //指示该报文由一台Apache Web服务器产生的

Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT //指示对象创建或者最后修改的时间

Content—Length: 6821 //指示了被发送对象中的字节数

Content—Type: text/html //指示实体体中的对象是HTML文本

(data   data  data  data  data  data……)//实体体
```



#### 1.8 用户与服务器的交互：cookie

- cookie的作用：它使站点实现对用户的跟踪
- cookie技术的四个组件：1 and 2：HTTP请求报文和HTTP响应报文中的cookie首部行；③用户端系统中的cookie文件，由用户的浏览器管理；④位于web站点的一个后端数据库

例子：当你首次逛淘宝时，，web站点将产生一个唯一的识别码，并以此作为索引在它的后端数据库中产生一个表项。接下来淘宝服务器用一个包含Set–cookie：首部的HTTP响应报文（例如： Set–cookie:1678）对你的浏览器响应。当你的浏览器接收到HTTP响应报文，该浏览器在其管理的特定文件中添加一行，该行包含服务器的主机名和在Set–cookie首部的唯一识别码。当你继续逛淘宝时，每请求一个web页面，其浏览器就会查询cookie文件并抽取网站的识别码，并放到HTTP请求报文中包含识别码的cookie首部行中。淘宝使用cookie来提供它的购物车服务，淘宝能够维护你希望购买的物品列表。

#### 1.9 web缓存

web缓存器也叫代理服务器，能够代表初始web服务器来满足HTTP请求的网络实体，它拥有自己的磁盘存储空间，并且保存最近请求过的对象副本。可以配置浏览器，使用户的所有HTTP请求首先指向web缓存器，一旦配置，每个对某个对象的浏览器请求首先被定向到该缓存器。

例如：

- 浏览器创建一个到web缓存器的TCP连接，并向web缓存器中的对象发送一个HTTP请求。

- web缓存器检查是否有该对象副本，如果有，则向客户浏览器用HTTP响应报文返回该请求对象。

- 如果没有，则它打开与初始服务器的TCP连接，web缓存器在这个TCP连接上发送HTTP请求报文，初始服务器收到请求    后，向缓存器发送包含该对象的响应报文。

- 当web缓存器接收到该对象时，它在本地存储空间存储一份副本，并向客户的浏览器发送包含请求对象的HTTP响应报文。

​    web缓存器既是服务器（对浏览器而言）又是客户（对初始服务器而言）

作用：web缓存器可以大大减少对客户请求的响应时间，特别是当客户与初始服务器之间的带宽远低于客户与缓存器之间的带宽时（原因在于缓存器可以满足客户的20%-70%的请求，且它们之间的速率为局域网速率）

问题一：放在缓存器中的对象副本如何确定是最新的？

   条件GET方法：缓存器向服务器发送条件GET报文，告诉服务器，仅当自指定日期之后该对象被修改过，才发送该对象

