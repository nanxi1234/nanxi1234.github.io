---
date: 2020-11-02 16:20:40
title: Spring框架
tags:
  - Spring
  - Spring boot
---

# Spring的优势

  Spring框架不会强迫让你实现Spring规范的接口或类，因为这会导致应用与框架绑死，在基于Spring构建的应用中，一个类会使用Spring注解，但它依然是POJO(plain ordinary Java object),这个类在Spring和非Spring应用中都发挥同样的作用。而Spring通过DI(依赖注入)来装配他们，帮助应用对象彼此之间保持松散耦合。

# DI

  试想：你的应用之中有许多类，这些类之间互相进行协作来完成特定的业务逻辑，每个对象负责管理与自己相互协作的对象的引用，这会导致类与类之间高度耦合，从而导致问题出现时牵一发而动全身。

  而DI就是为了解决这一问题而产生的一种设计模式理念！

 依赖注入（DI）是一个过程，通过该过程，对象只通过构造函数参数、工厂方法的参数或在对象实例构造或从工厂方法返回后在对象实例上设置的属性来定义其依赖项（即，它们与之一起工作的其他对象）。然后，容器在创建bean时注入那些依赖项。从根本上讲，此过程是通过使用类的直接构造或服务定位器模式来控制bean自身依赖关系的实例化或位置的bean本身的逆过程（*因此称为 Inversion of Control*）。

  使用DI原理，代码更简洁，当为对象提供依赖项时，去耦合会更有效。该对象不查找其依赖项，并且不知道依赖项的位置或类。结果，您的类变得更易于测试，尤其是当依赖项依赖于接口或抽象基类时，它们允许在单元测试中使用stub(*是指用来替换一部分功能的程序段。桩程序可以用来模拟已有程序的行为,或是对将要开发的代码的一种临时替代*)或模拟实现。

## Bean

  可重复使用的软件组件，实际上Java Bean是一种Java类，通过封装属性和方法，成为具有某种功能或者处理某个业务的对象。

  在Spring中，构成应用程序主干并由Spring IoC容器管理的对象称为bean。Bean是由Spring IoC容器实例化，组装和管理的对象。否则，bean仅仅是应用程序中许多对象之一。Bean及其之间的依赖关系反映在容器使用的配置元数据中。

  Bean定义实质上是创建一个或多个对象的方法。 容器在被询问时会查看命名bean的方法，并使用该bean定义的封装配置元数据来创建（*或获取*）实际对象。

## 容器

`  org.springframework.context.ApplicationContext`接口代表Spring IoC容器，并负责实例化，配置和组装Bean。容器通过读取配置元数据获取有关要实例化，配置和组装哪些对象的指令。配置元数据以XML，Java批注或Java代码表示。它使您能够表达组成应用程序的对象以及这些对象之间的丰富相互依赖关系。

![image-20201106123926522](https://cdn.jsdelivr.net/gh/nanxi1234/picture//2020/20201106132452.png)

## 配置元元素

​    如上图所示，Spring IoC容器使用一种形式的配置元数据。此配置元数据表示您作为应用程序开发人员如何告诉Spring容器实例化，配置和组装应用程序中的对象。

## 实例化容器

提供给`ApplicationContext`构造函数的一个或多个指示位置路径的资源字符串，可让容器从各种外部资源（*例如本地文件系统，Java等*）中加载配置元数据`CLASSPATH`。

```java
ApplicationContext context = new ClassPathXmlApplicationContext("services.xml", "daos.xml");
```

以下示例显示了服务层对象`(services.xml)`配置文件：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- services -->

    <bean id="petStore" class="org.springframework.samples.jpetstore.services.PetStoreServiceImpl">
        <property name="accountDao" ref="accountDao"/>
        <property name="itemDao" ref="itemDao"/>
        <!-- additional collaborators and configuration for this bean go here -->
    </bean>
c
    <!-- more bean definitions for services go here -->

</beans>
```

以下示例显示了数据访问对象`daos.xml`文件：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="accountDao"
        class="org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao">
        <!-- additional collaborators and configuration for this bean go here -->
    </bean>

    <bean id="itemDao" class="org.springframework.samples.jpetstore.dao.jpa.JpaItemDao">
        <!-- additional collaborators and configuration for this bean go here -->
    </bean>

    <!-- more bean definitions for data access objects go here -->

</beans>
```

以上代码使用属性注入，<property>元素为属性的Setter方法所提供的功能与<constructor-arg>元素为构造器所提供的功能是一样的(<constructor-arg>元素的功能：告知Spring要将一个ID为xxx的bean引用传递到XXXX的构造器中)，这里是将ID为accountDao和itemDao的bean(通过Ref属性)，将其注入petStore中。**Id和ref元素之间的这种链接表达了协作对象之间的依赖关系**。

